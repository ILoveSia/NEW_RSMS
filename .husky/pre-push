#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Pre-push hooks ì‹¤í–‰ ì¤‘..."

# ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
echo "ğŸ§ª ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."

# Frontend í…ŒìŠ¤íŠ¸
if [ -d "frontend" ] && [ -f "frontend/package.json" ]; then
    echo "ğŸ”· Frontend í…ŒìŠ¤íŠ¸ ì¤‘..."
    cd frontend
    if grep -q "\"test\":" package.json; then
        npm run test
        if [ $? -ne 0 ]; then
            echo "âŒ Frontend í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨. Pushê°€ ì¤‘ë‹¨ë©ë‹ˆë‹¤."
            exit 1
        fi
    else
        echo "âš ï¸  Frontend í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
    fi
    cd ..
fi

# Backend í…ŒìŠ¤íŠ¸
if [ -d "backend" ]; then
    echo "â˜• Backend í…ŒìŠ¤íŠ¸ ì¤‘..."
    cd backend
    ./gradlew test
    if [ $? -ne 0 ]; then
        echo "âŒ Backend í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨. Pushê°€ ì¤‘ë‹¨ë©ë‹ˆë‹¤."
        exit 1
    fi
    cd ..
fi

echo "âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í–ˆìŠµë‹ˆë‹¤. Pushë¥¼ ì§„í–‰í•©ë‹ˆë‹¤."